<main
  class="w-full max-w-7xl mx-auto px-4 py-8 flex flex-col justify-center items-center min-h-[65vh]"
>
  <!-- Loading state -->
  @if (isLoading()) {
  <div class="flex flex-col items-center justify-center my-8">
    <p-progressspinner
      class="mx-auto my-4 w-12 h-12"
      [strokeWidth]="'4'"
      animationDuration="1s"
      aria-label="Loading"
      size="xlarge"
    />
   
  </div>
  } @else if (error()) {
  <!-- Error state -->
  <div class="text-center my-8 text-red-500">
    <h2 class="text-2xl font-bold">Error</h2>
    <p class="mt-2">
      Could not find the user or an issue occurred. Please check the username
      and try again.
    </p>
  </div>
  } @else if (combinedData$ | async; as data) {
  <!-- Content is loaded -->
  <p-card
    [style]="{ overflow: 'hidden' }"
    class="w-full h-full lg:w-3/4 xl:w-2/3 border-none shadow-none bg-zinc-100 dark:bg-zinc-900/50"
  >
    <div
      class="flex flex-col md:flex-row items-center md:items-start space-x-0 md:space-x-8"
    >
      <!-- User avatar and details -->
      <div class="flex flex-col items-center space-y-4">
        <p-avatar
          [image]="data.user.avatar_url"
          [style]="{ width: '10rem', height: '10rem' }"
          styleClass="p-overlay-badge p-shadow-2 border-4 border-primary-500/20"
          shape="circle"
        ></p-avatar>
        <h1
          class="text-3xl md:text-4xl font-extrabold text-primary-500 text-center md:text-left"
        >
          {{ data.user.name || data.user.login }}
        </h1>
        <p
          class="text-lg md:text-xl font-medium text-zinc-600 dark:text-zinc-400"
        >
          {{ data.user.login }}
        </p>
        @if (data.user.bio) {
        <p
          class="text-center text-sm md:text-base text-zinc-500 dark:text-zinc-400"
        >
          {{ data.user.bio }}
        </p>
        }
        <div class="flex space-x-4 mt-2">
          <a
            [href]="data.user.html_url"
            target="_blank"
            class="pi pi-github text-primary-500 hover:text-primary-600 transition-colors"
          ></a>
          @if (data.user.twitter_username) {
          <a
            [href]="'https://twitter.com/' + data.user.twitter_username"
            target="_blank"
            class="pi pi-twitter text-primary-500 hover:text-primary-600 transition-colors"
          ></a>
          }
        </div>
      </div>

      <!-- User stats and info -->
      <div class="flex-1 w-full mt-8 md:mt-0">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm">
          <div
            class="flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-200/50 dark:bg-zinc-800/50"
          >
            <span class="text-xl font-bold">{{ data.user.public_repos }}</span>
            <span class="text-zinc-600 dark:text-zinc-400">Public Repos</span>
          </div>
          <div
            class="flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-200/50 dark:bg-zinc-800/50"
          >
            <span class="text-xl font-bold">{{ data.user.followers }}</span>
            <span class="text-zinc-600 dark:text-zinc-400">Followers</span>
          </div>
          <div
            class="flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-200/50 dark:bg-zinc-800/50"
          >
            <span class="text-xl font-bold">{{ data.user.following }}</span>
            <span class="text-zinc-600 dark:text-zinc-400">Following</span>
          </div>
          <div
            class="flex flex-col items-center justify-center p-2 rounded-lg bg-zinc-200/50 dark:bg-zinc-800/50"
          >
            <span class="text-xl font-bold">{{ data.user.public_gists }}</span>
            <span class="text-zinc-600 dark:text-zinc-400">Public Gists</span>
          </div>
        </div>
        <p-divider class="my-6"></p-divider>
        <!-- Repositories -->
        <h3 class="text-2xl font-bold mb-4">Repositories</h3>
        <div class="space-y-4">
          @for (repo of data.repos; track repo.id) {
          <div
            class="flex flex-col md:flex-row justify-between items-start md:items-center p-4 rounded-lg bg-zinc-200/50 dark:bg-zinc-800/50"
          >
            <div class="flex-1">
              <a
                [href]="repo.html_url"
                target="_blank"
                class="text-lg font-bold text-primary-500 hover:underline"
              >
                {{ repo.name }}
              </a>
              @if (repo.description) {
              <p class="text-sm mt-1 text-zinc-600 dark:text-zinc-400">
                {{ repo.description }}
              </p>
              }
            </div>
            <div
              class="flex items-center space-x-3 mt-2 md:mt-0 text-sm text-zinc-500 dark:text-zinc-400"
            >
              @if (repo.language) {
              <span>
                <i class="pi pi-code-branch"></i> {{ repo.language }}
              </span>
              }
              <span>
                <i class="pi pi-star"></i> {{ repo.stargazers_count }}
              </span>
              <span> <i class="pi pi-eye"></i> {{ repo.watchers_count }} </span>
            </div>
          </div>
          }
        </div>
        @if (data.repos.length > 0) {
        <div class="flex justify-center mt-6">
          <button
            pButton
            type="button"
            label="View All Repositories"
            [routerLink]="['/user', data.user.login, 'repos']"
            pRipple
            class="bg-primary-500 hover:bg-primary-600"
          ></button>
        </div>
        }
      </div>
    </div>
  </p-card>
  }
</main>
